(function(t){function e(e){for(var i,s,o=e[0],l=e[1],c=e[2],u=0,d=[];u<o.length;u++)s=o[u],n[s]&&d.push(n[s][0]),n[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);p&&p(e);while(d.length)d.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],i=!0,s=1;s<a.length;s++){var o=a[s];0!==n[o]&&(i=!1)}i&&(r.splice(e--,1),t=c(c.s=a[0]))}return t}var i={},n={app:0},r=[];function s(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-44e91c20":"b1d73121"}[t]+".js"}var o={};var l={9490:function(){return{"./index_bg.js":{__wbg_alert_3509f7478db780cf:function(t,e){return i["9a58"].exports["b"](t,e)},__wbindgen_json_serialize:function(t,e){return i["9a58"].exports["c"](t,e)},__wbindgen_throw:function(t,e){return i["9a58"].exports["d"](t,e)}}}}};function c(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,c),a.l=!0,a.exports}c.e=function(t){var e=[],a=n[t];if(0!==a)if(a)e.push(a[2]);else{var i=new Promise((function(e,i){a=n[t]=[e,i]}));e.push(a[2]=i);var r,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=s(t),r=function(e){u.onerror=u.onload=null,clearTimeout(d);var a=n[t];if(0!==a){if(a){var i=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src,s=new Error("Loading chunk "+t+" failed.\n("+i+": "+r+")");s.type=i,s.request=r,a[1](s)}n[t]=void 0}};var d=setTimeout((function(){r({type:"timeout",target:u})}),12e4);u.onerror=u.onload=r,document.head.appendChild(u)}var m={"chunk-44e91c20":["9490"]}[t]||[];return m.forEach((function(t){var a=o[t];if(a)e.push(a);else{var i,n=l[t](),r=fetch(c.p+""+{9490:"d95ceeff92befb6a8f41"}[t]+".module.wasm");if(n instanceof Promise&&"function"===typeof WebAssembly.compileStreaming)i=Promise.all([WebAssembly.compileStreaming(r),n]).then((function(t){return WebAssembly.instantiate(t[0],t[1])}));else if("function"===typeof WebAssembly.instantiateStreaming)i=WebAssembly.instantiateStreaming(r,n);else{var s=r.then((function(t){return t.arrayBuffer()}));i=s.then((function(t){return WebAssembly.instantiate(t,n)}))}e.push(o[t]=i.then((function(e){return c.w[t]=(e.instance||e).exports})))}})),Promise.all(e)},c.m=t,c.c=i,c.d=function(t,e,a){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(c.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)c.d(a,i,function(e){return t[e]}.bind(null,i));return a},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/helixiser/",c.oe=function(t){throw console.error(t),t},c.w={};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],d=u.push.bind(u);u.push=e,u=u.slice();for(var m=0;m<u.length;m++)e(u[m]);var p=d;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"106d":function(t,e,a){"use strict";var i=a("5c5c"),n=a.n(i);n.a},"2a11":function(t,e,a){},3167:function(t,e,a){"use strict";var i=a("bd9c"),n=a.n(i);n.a},"49d0":function(t,e,a){"use strict";var i=a("2a11"),n=a.n(i);n.a},"4f8f":function(t,e,a){"use strict";(function(t){var i=a("53ca"),n=a("bae0");e["a"]={name:"ImageViewer",components:{FourierPanel:n["a"]},data:function(){return{usingNode:!1}},mounted:function(){console.log("Imageviewer mounted"),document.title="Fig "+this.$route.params.id+" - Helixiser","object"===("undefined"===typeof t?"undefined":Object(i["a"])(t))?(console.log("[Node] Running from Node"),this.usingNode=!0):this.usingNode=!1}}}).call(this,a("4362"))},5377:function(t,e,a){"use strict";var i=a("c553"),n=a.n(i);n.a},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var i=a("2b0e"),n=a("8c4f"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("router-view")],1)},s=[],o={name:"App"},l=o,c=a("2877"),u=a("6544"),d=a.n(u),m=a("7496"),p=Object(c["a"])(l,r,s,!1,null,null,null),h=p.exports;d()(p,{VApp:m["a"]});var v=a("f309");i["a"].use(v["a"]);var f=new v["a"]({}),_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-main",[a("div",{staticClass:"layout-box"},[a("header",[a("div",{staticClass:"logo"}),a("span",{staticClass:"darkmode-mobile"},[t.darkMode?t._e():a("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({attrs:{icon:"",color:"rgba(0,0,0,0.54)"},on:{click:function(e){return t.setDarkMode(!0)}}},i),[a("v-icon",[t._v("mdi-weather-night")])],1)]}}],null,!1,3288988057)},[a("span",[t._v("Dark Mode")])]),t.darkMode?a("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({attrs:{icon:"",color:"#f9c72a"},on:{click:function(e){return t.setDarkMode(!1)}}},i),[a("v-icon",[t._v("mdi-white-balance-sunny")])],1)]}}],null,!1,228474762)},[a("span",[t._v("Light Mode")])]):t._e()],1)]),a("div",{staticClass:"layout-left"},[a("div",{staticClass:"rotated"},[a("a",{attrs:{href:"https://nemoandrea.github.io/",target:"_blank"}},[t._v("Built by Nemo Andrea")])]),a("div",{staticClass:"rotated"},[a("a",{attrs:{href:"https://github.com/NemoAndrea/helix-fft/blob/master/doc/examples.md",target:"_blank"}},[t._v("Examples")])]),a("div",{staticClass:"rotated"},[a("a",{attrs:{href:"https://github.com/NemoAndrea/helix-fft",target:"_blank"}},[t._v("Documentation")])])]),a("div",{staticClass:"layout-central"},[a("div",{staticClass:"ui-box ui-command-panel"},[a("div",{staticClass:"card card-accent"},[a("div",{staticClass:"card-title title-input"},[a("v-text-field",{attrs:{label:"Model name",dark:"",dense:"",color:"white"},model:{value:t.modelName,callback:function(e){t.modelName=e},expression:"modelName"}})],1),a("div",{staticClass:"meta-button-box"},[a("v-btn",{attrs:{outlined:"",color:"white"},on:{click:function(e){return t.loadExample()}}},[t._v("Load example")]),a("div",{staticClass:"share-buttons"},[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({attrs:{icon:"",color:"white"},on:{click:function(e){return t.exportCurrentHelixFamily()}}},i),[a("v-icon",[t._v("mdi-content-copy")])],1)]}}])},[a("span",[t._v("Copy link to model")])]),a("v-menu",{attrs:{left:"",bottom:"","close-on-click":!0,transition:"slide-y-transition","offset-y":!0},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,n=e.attrs;return[a("v-btn",t._g(t._b({attrs:{icon:"",color:"white"},on:{click:t.getShareValues}},"v-btn",n,!1),i),[a("v-icon",[t._v("mdi-share-variant")])],1)]}}])},[a("v-list",{attrs:{shaped:""}},[a("v-subheader",[t._v("SHARE TO")]),a("v-list-item",{attrs:{ripple:""}},[a("ShareNetwork",{attrs:{network:"twitter",url:t.modelURL,title:t.shareText,hashtags:"helixiser"}},[a("v-icon",{attrs:{color:"#1da1f2"}},[t._v("mdi-twitter")]),a("span",{staticStyle:{color:"gray!important"}},[t._v(" Twitter ")])],1)],1),a("v-list-item",{attrs:{ripple:""}},[a("ShareNetwork",{attrs:{network:"whatsapp",url:t.modelURL,title:t.shareText}},[a("v-icon",{attrs:{color:"#25d366"}},[t._v("mdi-whatsapp")]),a("span",{staticStyle:{color:"gray!important"}},[t._v(" Whatsapp ")])],1)],1),a("v-list-item",{attrs:{ripple:""}},[a("ShareNetwork",{attrs:{network:"telegram",url:t.modelURL,title:t.shareText}},[a("v-icon",{attrs:{color:"#0088cc"}},[t._v("mdi-telegram")]),a("span",{staticStyle:{color:"gray!important"}},[t._v(" Telegram ")])],1)],1),a("v-list-item",{attrs:{ripple:""}},[a("ShareNetwork",{attrs:{network:"reddit",url:t.modelURL,title:t.shareText}},[a("v-icon",{attrs:{color:"#ff4500"}},[t._v("mdi-reddit")]),a("span",{staticStyle:{color:"gray!important"}},[t._v(" Reddit ")])],1)],1)],1)],1),a("v-menu",{attrs:{"max-width":"var(--more-options-menu-width)",bottom:"","close-on-click":!0,transition:"slide-y-transition","offset-y":!0},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,n=e.attrs;return[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var r=e.on;return[a("v-btn",t._g(t._b({attrs:{dark:"",icon:""}},"v-btn",n,!1),Object.assign({},r,i)),[a("v-icon",[t._v("mdi-dots-vertical")])],1)]}}],null,!0)},[a("span",[t._v("More settings")])])]}}])},[a("div",{staticClass:"more-options"},[a("v-card",{staticClass:"more-options-card"},[a("v-card-title",[t._v(" Set distance units ")]),a("v-card-subtitle",[t._v("Select a distance unit. Your choice will be included in the exported model.")]),a("v-card-actions",t._l(Object.keys(t.unitTypes),(function(e){return a("v-btn",{key:e,attrs:{text:"",color:"var(--primary)"},on:{click:function(a){return t.setUnit(e)}}},[t._v(" "+t._s(e)+" ")])})),1)],1),a("v-card",[a("v-card-title",[t._v(" Set image dimensions ")]),a("v-card-subtitle",[t._v(" Set the dimensions of the diffraction pattern. The resulting image will always be square. Values above the default of 512px will increase computational time.")]),a("v-card-actions",[a("div",{staticClass:"rastersize-box"},[a("v-btn",{attrs:{icon:"",color:"var(--primary)"},on:{click:function(e){return t.setRasterSize(t.rasterSize/2)}}},[a("v-icon",[t._v("mdi-minus")])],1),t._v(" "+t._s(t.rasterSize)+" "),a("v-btn",{attrs:{icon:"",color:"var(--primary)"},on:{click:function(e){return t.setRasterSize(2*t.rasterSize)}}},[a("v-icon",[t._v("mdi-plus")])],1)],1)])],1)],1)])],1)],1)]),a("div",{staticClass:"card"},[a("parameter-panel",{ref:"paramPanel",attrs:{unit:t.unit},on:{updateHelixFamily:function(e){return t.setHelixFamily(e)},computeHelixFamily:function(e){return t.computeHelixFamily()},updateName:function(e){t.modelName=arguments[0]},newDisplayParams:function(e){t.displaySettings=arguments[0]},newModelURL:function(e){t.modelURL=arguments[0]}}})],1)]),a("div",{staticClass:"ui-box ui-realspace-panel"},[a("div",{staticClass:"card card-webgl"},[a("helix-display",{attrs:{helixFamily:t.helixFamily}})],1)]),a("div",{staticClass:"ui-box ui-fft-panel"},[a("fourier-panel",{ref:"fourierPanel",attrs:{helixFamily:t.helixFamily,updateCounter:t.updateCounter,name:t.modelName,unit:t.unit,externalDisplayParams:t.displaySettings,rasterSize:t.rasterSize},on:{exportDisplayParams:function(e){t.displaySettings=arguments[0]}}})],1)]),a("div",{staticClass:"layout-right"}),a("footer",[t.darkMode?t._e():a("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({attrs:{icon:"",color:"rgba(0,0,0,0.54)"},on:{click:function(e){return t.setDarkMode(!0)}}},i),[a("v-icon",[t._v("mdi-weather-night")])],1)]}}],null,!1,3288988057)},[a("span",[t._v("Dark Mode")])]),t.darkMode?a("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({attrs:{icon:"",color:"#f9c72a"},on:{click:function(e){return t.setDarkMode(!1)}}},i),[a("v-icon",[t._v("mdi-white-balance-sunny")])],1)]}}],null,!1,228474762)},[a("span",[t._v("Light Mode")])]):t._e(),a("a",{staticStyle:{"margin-left":"1rem"},attrs:{href:"https://twitter.com/cursed_tubule",target:"_blank"}},[t._v("Twitter ")])],1)]),a("v-snackbar",{scopedSlots:t._u([{key:"action",fn:function(e){var i=e.attrs;return[a("v-btn",t._b({attrs:{color:"pink",text:""},on:{click:function(e){t.snackbar=!1}}},"v-btn",i,!1),[t._v(" Close ")])]}}]),model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v(" "+t._s(t.snackText)+" ")])],1)],1)},b=[],g=(a("caad"),a("90d7"),a("a9e3"),a("b64b"),a("d3b7"),a("25f0"),a("2532"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"helix-display"},[a("div",{staticClass:"card-title-float card-title"},[t._v("Realspace "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.planarMode,expression:"!planarMode"}]},[t._v("Helix")]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.planarMode,expression:"planarMode"}]},[t._v("Lattice")])]),t.fullscreen?a("div",{staticClass:"top-realspace-buttons"},[t.planarMode?a("div",{staticClass:"planarMode-list"},[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({staticClass:"top-realspace-item",attrs:{dark:"",color:"var(--primary)",fab:""},on:{click:function(e){t.planarOptions.basis=!t.planarOptions.basis}}},i),[a("v-icon",[t._v("mdi-axis-arrow-info")])],1)]}}],null,!1,2425265408)},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.planarOptions.basis,expression:"planarOptions.basis"}]},[t._v("Hide lattice basis vectors")]),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.planarOptions.basis,expression:"!planarOptions.basis"}]},[t._v("Show lattice basis vectors")])]),a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({staticClass:"top-realspace-item",attrs:{dark:"",color:"var(--primary)",fab:""},on:{click:function(e){t.planarOptions.axis=!t.planarOptions.axis}}},i),[a("v-icon",[t._v("mdi-axis-arrow")])],1)]}}],null,!1,2556297475)},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.planarOptions.axis,expression:"planarOptions.axis"}]},[t._v("Hide axis system")]),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.planarOptions.axis,expression:"!planarOptions.axis"}]},[t._v("Show axis system")])]),a("div",{staticClass:"h-spacer top-realspace-item"}),a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({staticClass:"top-realspace-item",attrs:{dark:"",color:"var(--primary)",fab:""},on:{click:function(e){t.planarMode=!1}}},i),[a("v-icon",[t._v("mdi-dna")])],1)]}}],null,!1,3059750304)},[a("span",[t._v("Roll up lattice into helix")])])],1):t._e(),t.planarMode?t._e():a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({staticClass:"top-realspace-item",attrs:{dark:"",color:"var(--primary)",fab:""},on:{click:function(e){t.planarMode=!0}}},i),[a("v-icon",[t._v("mdi-dots-hexagon")])],1)]}}],null,!1,4125652051)},[a("span",[t._v("Unroll into lattice")])]),t.planarMode&&t.planarOptions.basis?a("div",{staticClass:"lattice-basis"},[a("v-card",{staticClass:"mx-auto",attrs:{"max-width":"344",outlined:""}},[a("v-list-item",{attrs:{"three-line":""}},[a("v-list-item-content",[a("div",{staticClass:"overline mb-4"},[t._v(" Lattice parameters ")]),a("v-list-item-subtitle",[t._v("Select helix from dropdown list.")])],1)],1),a("v-card-actions",[a("v-btn",{attrs:{outlined:"",rounded:"",text:"",disabled:""}},[t._v(" Show in realspace image ")])],1)],1)],1):t._e()],1):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:t.helixFamily.length>0,expression:"helixFamily.length > 0"}],staticClass:"realspace-controls"},[a("div",[a("v-tooltip",{attrs:{right:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({staticClass:"left-realspace-item",attrs:{dark:"",fab:"",color:"var(--primary)",hidden:t.planarMode},on:{click:function(e){t.rotate=!t.rotate}}},i),[t.rotate?a("v-icon",[t._v("mdi-pause")]):t._e(),t.rotate?t._e():a("v-icon",[t._v("mdi-play")])],1)]}}])},[a("span",[t._v("Toggle auto-rotation")])])],1),a("div",{staticClass:"button-fullscreen"},[a("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({attrs:{dark:"",fab:"",color:"var(--primary)"},on:{click:t.toggleFullscreen}},i),[t.fullscreen?a("v-icon",[t._v("mdi-fullscreen-exit")]):t._e(),t.fullscreen?t._e():a("v-icon",[t._v("mdi-fullscreen")])],1)]}}])},[a("span",[t._v("Fullscreen")])])],1)])])}),y=[],x=(a("ddb0"),a("3835")),w=a("b85c"),k=a("5a89"),S=a("4721"),T=a("30fa"),C={name:"HelixDisplay",props:{helixFamily:{type:Array}},watch:{helixFamily:{handler:function(){this.refreshHelix()},deep:!0},planarMode:{handler:function(){this.refreshHelix(),this.controls.target.set(0,0,this.cam_z),this.camera.position.set(0,-this.cam_radius,this.cam_z)}},planarOptions:{handler:function(){this.refreshHelix()},deep:!0}},data:function(){return{scene:"",rotationRate:.01,rotate:!0,fullscreen:!1,camera:"",cam_radius:160,cam_z:50,renderer:"",controls:null,raycaster:null,mouse:null,scaleFac:1,crosshair:{horizontal:null,vertical:null},effect:"",container:"",colors:[new k["e"](211/255,94/255,96/255),new k["e"](.255,.31,.455),new k["e"](128/255,133/255,133/255),new k["e"](144/255,103/255,167/255),new k["e"](114/255,147/255,203/255),new k["e"](225/255,151/255,76/255),new k["e"](132/255,186/255,91/255),new k["e"](.8,194/255,16/255)],planarMode:!1,planarOptions:{axis:!0,basis:!1}}},methods:{refreshHelix:function(){console.log("redrawing the helix (three.js)"),this.planarMode?this.drawLattice():this.drawHelix()},drawHelix:function(){console.log("drawing a realspace helix...");while(this.scene.children.length>0)this.scene.remove(this.scene.children[0]);var t,e=Number(this.helixFamily[0]["radius"])+Number(this.helixFamily[0]["unit_size"]),a=Object(w["a"])(this.helixFamily);try{for(a.s();!(t=a.n()).done;){var i=t.value,n=Number(i["radius"])+Number(i["unit_size"]);1/n<1/e&&(e=n)}}catch(_){a.e(_)}finally{a.f()}var r,s=10/e,o=1,l=Object(w["a"])(this.helixFamily.entries());try{for(l.s();!(r=l.n()).done;){var c=Object(x["a"])(r.value,2),u=c[0],d=c[1];u<this.colors.length&&(this.material=new k["l"]({color:this.colors[u]})),o="left"===d["handedness"]?-1:1;var m=Math.ceil(100/(d["rise"]*s));m>1e3&&(m=1e3);for(var p=new k["s"](d["unit_size"]*s,32,16),h=0;h<m;h++){var v=new k["k"](p,this.material.clone()),f=Number(d["rotation"])/180*Math.PI+o*h*2*Math.PI/d["frequency"];v.position.x=d["radius"]*s*Math.cos(f),v.position.y=d["radius"]*s*Math.sin(f),v.position.z=h*d["rise"]*s+d["offset"]*s,this.scene.add(v)}}}catch(_){l.e(_)}finally{l.f()}this.controls.enableRotate=!0,this.addLights(),this.refreshDisplay(this.container)},drawLattice:function(){console.log("unfolding helix into lattice and drawing lattice...");while(this.scene.children.length>0)this.scene.remove(this.scene.children[0]);var t,e=Number(this.helixFamily[0]["radius"])+Number(this.helixFamily[0]["unit_size"]),a=Object(w["a"])(this.helixFamily);try{for(a.s();!(t=a.n()).done;){var i=t.value,n=Number(i["radius"])+Number(i["unit_size"]);1/n<1/e&&(e=n)}}catch(b){a.e(b)}finally{a.f()}this.scaleFac=10/e;var r,s=Number(this.helixFamily[0]["radius"])*this.scaleFac*2*Math.PI,o=1,l=Object(w["a"])(this.helixFamily.entries());try{for(l.s();!(r=l.n()).done;){var c=Object(x["a"])(r.value,2),u=c[0],d=c[1];u<this.colors.length&&(this.material=new k["l"]({color:this.colors[u]})),o="left"===d["handedness"]?-1:1;var m=Math.ceil(100/(d["rise"]*this.scaleFac));m>1e3&&(m=1e3);for(var p=new k["s"](d["unit_size"]*this.scaleFac,32,16),h=d["radius"]*this.scaleFac*2*Math.PI,v=0;v<m;v++){var f=new k["k"](p,this.material.clone()),_=Number(d["rotation"])/180*Math.PI+o*v*2*Math.PI/d["frequency"];f.position.x=d["radius"]*this.scaleFac*_%h-h/2,f.position.z=v*d["rise"]*this.scaleFac+d["offset"]*this.scaleFac,this.scene.add(f)}}}catch(b){l.e(b)}finally{l.f()}this.rotate=!1,this.controls.enableRotate=!1,this.planarOptions.axis&&this.drawAxes(-s/2),this.planarOptions.basis&&this.drawBasisVectors(!0,-s/2),this.scene.add(this.crosshair.vertical),this.scene.add(this.crosshair.horizontal),this.addLights(),this.refreshDisplay(this.container)},addLights:function(){var t=new k["a"](16777215,.75);this.scene.add(t);var e=new k["f"](16777215,1);e.position.set(1,-1,1).normalize(),e.intensity=.25,e.castShadow=!0,this.scene.add(e)},setupDisplay:function(t){var e=this;this.container=document.querySelector(t),this.scene=new k["q"],this.renderer=new k["z"]({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight);var a=this.container.appendChild(this.renderer.domElement);a.style.display="block",this.effect=new T["a"](this.renderer),k["m"].DefaultUp=new k["y"](0,0,1),this.camera=new k["n"](40,this.container.offsetWidth/this.container.offsetHeight,.1,5e3),this.cameraTarget=new k["y"](0,0,this.cam_z),this.raycaster=new k["p"],this.mouse=new k["x"];var i=[];i.push(new k["y"](0,0,0)),i.push(new k["y"](0,0,0));var n=new k["i"]({color:13882323,depthTest:!1}),r=(new k["d"]).setFromPoints(i);this.crosshair.vertical=new k["h"](r,n),this.crosshair.horizontal=new k["h"](r.clone(),n),this.controls=new S["a"](this.camera,this.renderer.domElement),this.controls.autoRotate=this.rotate,this.controls.target.set(0,0,this.cam_z),this.camera.position.set(this.cam_radius,0,this.cam_z),this.controls.enableKeys=!1,this.controls.update(),window.addEventListener("resize",(function(){return e.refreshDisplay(e.container)}),!1),window.addEventListener("mousemove",this.onMouseMove,!1);var s=function t(){requestAnimationFrame(t),o()},o=function(){if(e.controls.update(),e.controls.autoRotate=e.rotate,e.effect.render(e.scene,e.camera),e.camera.lookAt(e.cameraTarget),e.planarMode){e.raycaster.setFromCamera(e.mouse,e.camera);var t=e.raycaster.intersectObjects(e.scene.children);t.length>0?(e.drawCrosshair(t),e.crosshair.vertical.visible=!0,e.crosshair.horizontal.visible=!0):(e.crosshair.vertical.visible=!1,e.crosshair.horizontal.visible=!1)}};console.log("[ Realspace Helix display ready. ]"),s()},drawAxes:function(t){var e=[],a=[];e.push(new k["y"](t,0,0)),a.push(new k["y"](t,0,0)),e.push(new k["y"](t+500,0,0)),a.push(new k["y"](t,0,500));var i=new k["i"]({color:16744576});i.linewidth=10;var n=new k["i"]({color:952020}),r=(new k["d"]).setFromPoints(e),s=(new k["d"]).setFromPoints(a),o=new k["h"](r,i),l=new k["h"](s,n);this.scene.add(l),this.scene.add(o)},drawBasisVectors:function(t,e){console.log("Drawing basis vectors and zoom setting:",t);var a,i,n=this.computeBasis(),r=Object(w["a"])(n);try{for(r.s();!(i=r.n()).done;){a=i.value;var s=a.A,o=a.B,l=new k["y"](e,0,0),c=Math.sqrt(Math.pow(s.x,2)+Math.pow(s.z,2)),u=Math.sqrt(Math.pow(o.x,2)+Math.pow(o.z,2)),d=15378944,m=new k["b"](s,l,c,d,.3*c,2),p=new k["b"](o,l,u,d,.3*u,2);m.cone.material.depthTest=!1,m.line.material.depthTest=!1,p.cone.material.depthTest=!1,p.line.material.depthTest=!1,this.scene.add(m),this.scene.add(p)}}catch(h){r.e(h)}finally{r.f()}},drawCrosshair:function(t){var e=500,a=t[0].object.position,i=this.crosshair.horizontal.geometry.attributes.position.array;i[0]=a.x-e,i[2]=i[5]=a.z,i[3]=a.x+e,this.crosshair.horizontal.geometry.attributes.position.needsUpdate=!0;var n=this.crosshair.vertical.geometry.attributes.position.array;n[2]=a.z-e,n[0]=n[3]=a.x,n[5]=a.z+e,this.crosshair.vertical.geometry.attributes.position.needsUpdate=!0},refreshDisplay:function(t){console.log("Refreshing aspect ratio plot"),this.camera.aspect=t.offsetWidth/t.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(t.offsetWidth,t.offsetHeight)},onMouseMove:function(t){this.mouse.x=t.offsetX/this.renderer.domElement.clientWidth*2-1,this.mouse.y=-t.offsetY/this.renderer.domElement.clientHeight*2+1},toggleFullscreen:function(){this.fullscreen=!this.fullscreen;var t=document.querySelector(".ui-realspace-panel");this.fullscreen?(console.log("[realspace helix] going fullscreen"),t.style.position="absolute",t.style.width="90vw",t.style.height="80vh"):(console.log("[realspace helix] leaving fullscreen"),t.style.position="static",t.style.width="0px",t.style.height="auto"),this.refreshDisplay(this.container)},computeBasis:function(){console.log("computing basis vectors....");var t,e=[],a=Object(w["a"])(this.helixFamily);try{for(a.s();!(t=a.n()).done;){var i=t.value,n=2*Math.PI/i["frequency"],r=i["radius"]*this.scaleFac*n,s=new k["y"](r,0,i["rise"]*this.scaleFac),o=i["radius"]*this.scaleFac*2*Math.PI,l=i["radius"]*this.scaleFac*n*Math.ceil(i["frequency"])%o,c=new k["y"](l,0,i["rise"]*i["frequency"]*this.scaleFac);e.push({A:s,B:c});break}}catch(u){a.e(u)}finally{a.f()}return e}},mounted:function(){this.setupDisplay(".helix-display")}},F=C,L=(a("106d"),a("8336")),U=a("b0af"),M=a("99d9"),z=a("132d"),I=a("da13"),N=a("5d23"),R=a("3a2f"),V=Object(c["a"])(F,g,y,!1,null,null,null),O=V.exports;d()(V,{VBtn:L["a"],VCard:U["a"],VCardActions:M["a"],VIcon:z["a"],VListItem:I["a"],VListItemContent:N["a"],VListItemSubtitle:N["b"],VTooltip:R["a"]});var A=a("bae0"),P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._m(0),a("v-form",{ref:"form",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[t._l(t.helixFamily,(function(e,i){return a("div",{key:i},[a("div",{staticClass:"helix-header"},[a("div",{staticClass:"helix-number",on:{click:function(e){return t.setInFocus(i+1)}}},[a("div",[t._v("helix "+t._s(i+1))]),a("div",{staticClass:"helix-button-box"},[i+1!==t.inputInFocus?a("div",[a("v-icon",[t._v(" mdi-chevron-down ")])],1):t._e(),i+1===t.inputInFocus?a("div",[a("v-icon",[t._v(" mdi-chevron-up")])],1):t._e()])]),i+1===t.inputInFocus?a("div",{staticClass:"helix-button-box-focus"},[a("div",{staticClass:"handedness-button"},["right"===e["handedness"]?a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var n=i.on;return[a("v-icon",t._g({attrs:{color:"var(--bw-button-color)"},on:{click:function(a){return t.toggleHandedness(e)}}},n),[t._v(" mdi-axis-z-rotate-counterclockwise")])]}}],null,!0)},[a("span",[t._v("Make left-handed helix")])]):t._e(),"left"===e["handedness"]?a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var n=i.on;return[a("v-icon",t._g({attrs:{color:"var(--bw-button-color)"},on:{click:function(a){return t.toggleHandedness(e)}}},n),[t._v(" mdi-axis-z-rotate-clockwise")])]}}],null,!0)},[a("span",[t._v("Make right handed helix")])]):t._e()],1),a("div",{staticClass:"delete-button"},[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[a("v-icon",t._g({attrs:{color:"var(--bw-button-color)"},on:{click:function(e){return t.resetParameters(i)}}},n),[t._v(" mdi-minus-circle ")])]}}],null,!0)},[a("span",[t._v("Delete helix")])])],1),a("div",{staticClass:"copy-button"},[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;return[a("v-icon",t._g({attrs:{color:"var(--bw-button-color)"},on:{click:function(e){return t.copyHelixParams(i)}}},n),[t._v(" mdi-content-copy")])]}}],null,!0)},[a("span",[t._v("Copy params to new helix")])])],1)]):t._e()]),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:i+1===t.inputInFocus,expression:"index+1 === inputInFocus"}]},[a("v-text-field",{attrs:{rules:t.numberRules,label:"Radius",required:"",outlined:"",color:"var(--primary)",suffix:t.unit.label,type:"number"},model:{value:e["radius"],callback:function(a){t.$set(e,"radius",a)},expression:"helix['radius']"}}),a("v-text-field",{attrs:{rules:t.numberRules,label:"Rise",required:"",outlined:"",color:"var(--primary)",suffix:t.unit.label,type:"number"},model:{value:e["rise"],callback:function(a){t.$set(e,"rise",a)},expression:"helix['rise']"}}),a("v-text-field",{attrs:{rules:t.numberRules,label:"Subunits per pitch",required:"",outlined:"",color:"var(--primary)",type:"number"},model:{value:e["frequency"],callback:function(a){t.$set(e,"frequency",a)},expression:"helix['frequency']"}}),a("v-text-field",{attrs:{rules:t.numberRules,label:"Unit size",required:"",outlined:"",color:"var(--primary)",suffix:t.unit.label,type:"number"},model:{value:e["unit_size"],callback:function(a){t.$set(e,"unit_size",a)},expression:"helix['unit_size']"}}),a("div",{directives:[{name:"show",rawName:"v-show",value:i+1>1,expression:"index+1 > 1"}],staticClass:"optional-params"},[a("div",{staticClass:"mini-field"},[a("v-text-field",{attrs:{rules:t.numberAndZeroRules,label:"Helix Z offset",outlined:"",required:"",color:"var(--primary)",suffix:t.unit.label,type:"number"},model:{value:e["offset"],callback:function(a){t.$set(e,"offset",a)},expression:"helix['offset']"}})],1),a("div",{staticClass:"mini-field"},[a("v-text-field",{attrs:{rules:t.anyNumberRules,label:"Rotation",outlined:"",required:"",color:"var(--primary)",suffix:"deg",type:"number"},model:{value:e["rotation"],callback:function(a){t.$set(e,"rotation",a)},expression:"helix['rotation']"}})],1)])],1)])],1)})),a("div",{staticClass:"button-box"},[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({attrs:{dark:"",fab:"",color:"var(--primary)"},on:{click:t.newHelix}},i),[a("v-icon",[t._v("mdi-plus")])],1)]}}])},[a("span",[t._v("Add another helix")])]),a("div",{staticClass:"button-box"},[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("span",t._g({},i),[a("v-checkbox",{staticClass:"live-button",attrs:{label:"live",color:"var(--primary)"},model:{value:t.liveCompute,callback:function(e){t.liveCompute=e},expression:"liveCompute"}})],1)]}}])},[a("span",[t._v("Automatically compute FFT on parameter change")])]),a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({attrs:{disabled:!t.valid||t.liveCompute,color:"var(--primary)"},on:{click:function(e){return t.computeHelix(!0)}}},i),[t._v(" Compute ")])]}}])},[a("span",[t._v("Show helix and compute FFT")])])],1)],1)],2),a("v-snackbar",{scopedSlots:t._u([{key:"action",fn:function(e){var i=e.attrs;return[a("v-btn",t._b({attrs:{color:"pink",text:""},on:{click:function(e){t.snackbar=!1}}},"v-btn",i,!1),[t._v(" Close ")])]}}]),model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v(" "+t._s(t.snackText)+" ")])],1)},E=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"helix-title"},[a("div",{staticClass:"card-title"},[t._v("Helix parameters")])])}],j=(a("a15b"),a("fb6a"),a("a434"),a("4fad"),a("ac1f"),a("3ca3"),a("5319"),a("1276"),a("2b3d"),a("5530")),D=a("2909"),H={name:"ParameterPanel",props:{unit:{type:Object,default:function(){return{label:"Å",factor:.1}}}},data:function(){return{valid:!1,liveCompute:!1,numberRules:[function(t){return!!t||"parameter is required"},function(t){return t>0||"value must be larger than 0"}],numberAndZeroRules:[function(t){return!!t||"parameter is required"},function(t){return t>=0||"value must be larger or equal to 0"}],anyNumberRules:[function(t){return!!t||"parameter is required"}],default_params:{radius:"",rise:"",frequency:"",unit_size:"",offset:"0",rotation:"0",handedness:"right"},helixFamily:[],inputInFocus:1,snackbar:!1,snackText:"unspecified",modelName:""}},watch:{helixFamily:{handler:function(){this.liveCompute&&this.valid&&this.computeHelix(!0)},deep:!0}},methods:{computeHelix:function(t){this.sendHelixFamily(),t&&this.computeHelixFamily()},sendHelixFamily:function(){console.log("Sending new helix-family off for computation"),this.$emit("updateHelixFamily",Object(D["a"])(this.helixFamily))},computeHelixFamily:function(){this.$emit("computeHelixFamily")},newHelix:function(){this.helixFamily.push(this.default_params)},setInFocus:function(t){this.inputInFocus===t?this.inputInFocus=-1:this.inputInFocus=t},parseQueryString:function(){console.log("Checking query string");var t,e=new URLSearchParams(this.$route.hash),a=[],i={},n={},r=Object.keys(this.default_params),s=[],o=Object(w["a"])(e);try{for(o.s();!(t=o.n()).done;){var l=Object(x["a"])(t.value,2),c=l[0],u=l[1];c=c.replace("#",""),console.log(c,u),"radius"===c&&(a.push(Object(j["a"])({},this.default_params)),i=a[a.length-1]),r.includes(c)?i[c]=u:"name"===c?this.$emit("updateName",u):"n"===c||"m"===c||"s"===c?n[c]=u:s.push(c)}}catch(d){o.e(d)}finally{o.f()}s.length>0&&(this.snackbar=!0,this.snackText="The following invalid keys were ignored: "+s.join(", ")),a.length>0?(console.log("query string loaded for: ".concat(a.length," helix objects")),this.helixFamily=a,this.computeHelix(!0),n&&this.$emit("newDisplayParams",n)):console.log("No query string parsed.")},copyHelixParams:function(t){console.log("Copying parameters of helix ".concat(t+1," into a new helix")),this.helixFamily.push(Object(j["a"])({},this.helixFamily[t])),this.snackText="Copied helix parameters from helix ".concat(t+1),this.snackbar=!0},toggleHandedness:function(t){"right"===t["handedness"]?t["handedness"]="left":"left"===t["handedness"]&&(t["handedness"]="right")},generateModelURL:function(t,e){var a=window.location.href.split("#")[0];if(a+="#/#",t&&(a+="name="+t.replace(/ /g,"%20")),Object.entries(e).length>0)for(var i=0,n=Object.entries(e);i<n.length;i++){var r=Object(x["a"])(n[i],2),s=r[0],o=r[1];"?"!==a.slice(-1)?a+="&"+s+"="+o:a+=s+"="+o}var l,c=Object(w["a"])(this.helixFamily);try{for(c.s();!(l=c.n()).done;)for(var u=l.value,d=0,m=Object.entries(u);d<m.length;d++){var p=Object(x["a"])(m[d],2),h=p[0],v=p[1];a.length>1?a+="&"+h+"="+v:a+=h+"="+v}}catch(f){c.e(f)}finally{c.f()}return a},exportModel:function(t,e){var a=this.generateModelURL(t,e),i=document.createElement("textarea");document.body.appendChild(i),i.value=a,i.select(),document.execCommand("copy"),document.body.removeChild(i),console.log(a),this.snackText="copied model URL to clipboard",this.snackbar=!0},emitModelURL:function(t,e){var a=this.generateModelURL(t,e);this.$emit("newModelURL",a)},resetParameters:function(t){t<0||1==this.helixFamily.length?this.helixFamily=[this.default_params]:(this.helixFamily.splice(t,1),this.inputInFocus=-1),this.sendHelixFamily()},test5:function(t){console.log(t)}},mounted:function(){this.helixFamily.push(this.default_params),this.parseQueryString()}},q=H,$=(a("5377"),a("ac7c")),B=a("4bd4"),G=a("2db4"),W=a("8654"),Y=Object(c["a"])(q,P,E,!1,null,"193e48a7",null),X=Y.exports;d()(Y,{VBtn:L["a"],VCheckbox:$["a"],VForm:B["a"],VIcon:z["a"],VSnackbar:G["a"],VTextField:W["a"],VTooltip:R["a"]});var Z=a("bd8c"),J=a.n(Z),Q=(a("dca8"),{nanometer:{label:"nm",factor:1},angstrom:{label:"Å",factor:.1},micron:{label:"um",factor:1e3}});Object.freeze(Q),i["a"].use(J.a);var K={name:"Interface",components:{ParameterPanel:X,HelixDisplay:O,FourierPanel:A["a"]},data:function(){return{helixFamily:[],displaySettings:{},modelName:"",updateCounter:0,modelURL:"",shareText:"",darkMode:!1,rasterSize:512,unit:Q.angstrom,unitTypes:Q,snackbar:!1,snackText:"unspecified"}},watch:{modelName:{handler:function(){this.updatePageTitle()}}},methods:{loadExample:function(){window.location.hash="#/#name=B-DNA&m=1&radius=1&rise=0.34&frequency=10&unit_size=0.18&radius=1&rise=0.34&frequency=10&unit_size=0.18&rotation=143",location.reload()},setHelixFamily:function(t){this.helixFamily=t},computeHelixFamily:function(){this.updateCounter++,console.log(">> We have computed ".concat(this.updateCounter," FFTs "))},exportCurrentHelixFamily:function(){this.$refs.fourierPanel.exportDisplayParams(),this.$refs.paramPanel.exportModel(this.modelName,this.displaySettings)},getShareValues:function(){this.$refs.fourierPanel.exportDisplayParams(),this.$refs.paramPanel.emitModelURL(this.modelName,this.displaySettings),this.modelName?this.shareText="Check out diffraction pattern of (helical) "+this.modelName+". ":this.shareText="Check out the diffraction pattern of this helical structure. "},updatePageTitle:function(){this.modelName?document.title=this.modelName+" | Helixiser":document.title="Helixiser"},setDarkMode:function(t){t?(this.darkMode=!0,document.body.setAttribute("data-theme","dark"),this.$vuetify.theme.dark=this.darkMode,localStorage.setItem("dark_theme",this.darkMode.toString())):(this.darkMode=!1,document.body.removeAttribute("data-theme"),this.$vuetify.theme.dark=this.darkMode,localStorage.setItem("dark_theme",this.darkMode.toString()))},setUnit:function(t){Object.keys(Q).includes(t)?(this.unit=Q[t],localStorage.setItem("distance_unit",t)):(this.snackText='Failed to set distance unit to "'.concat(t,'". Distance set to "nm" instead.'),this.snackbar=!0,localStorage.setItem("distance_unit","angstrom"))},setRasterSize:function(t){Math.log2(t)%1===0?(localStorage.setItem("canvas_rastersize",String(t)),this.rasterSize=t,console.log("New rastersize set: ",t)):(this.snackText="Failed to set canvas size to ".concat(t,". Distance set to 512 instead."),this.snackbar=!0,localStorage.setItem("canvas_rastersize",String(512)),this.rasterSize=512)}},mounted:function(){console.log("[ Loaded main component ]");var t=localStorage.getItem("dark_theme");"true"===t?this.setDarkMode(!0):this.setDarkMode(!1);var e=localStorage.getItem("canvas_rastersize");null!==e?this.setRasterSize(Number(e)):localStorage.setItem("canvas_rastersize",String(this.rasterSize));var a=localStorage.getItem("distance_unit");null!==a?this.setUnit(a):localStorage.setItem("distance_unit","angstrom")}},tt=K,et=(a("fde3"),a("8860")),at=a("f6c4"),it=a("e449"),nt=a("e0c7"),rt=Object(c["a"])(tt,_,b,!1,null,null,null),st=rt.exports;d()(rt,{VBtn:L["a"],VCard:U["a"],VCardActions:M["a"],VCardSubtitle:M["b"],VCardTitle:M["c"],VIcon:z["a"],VList:et["a"],VListItem:I["a"],VMain:at["a"],VMenu:it["a"],VSnackbar:G["a"],VSubheader:nt["a"],VTextField:W["a"],VTooltip:R["a"]});var ot=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"image-viewer"},[a("div",{staticStyle:{"font-size":"4rem"}},[t._v("Helixiser Figure "+t._s(t.$route.params.id))]),a("div",[t._v("running from node: "+t._s(t.usingNode))]),a("fourier-panel")],1)},lt=[],ct=a("4f8f"),ut=ct["a"],dt=(a("49d0"),Object(c["a"])(ut,ot,lt,!1,null,"022705f9",null)),mt=dt.exports;i["a"].config.productionTip=!1,i["a"].use(n["a"]);var pt=[{path:"/",component:st,name:"promotional"},{path:"/figure/:id",component:mt}],ht=new n["a"]({routes:pt});new i["a"]({vuetify:f,router:ht,render:function(t){return t(h)}}).$mount("#app")},"5c5c":function(t,e,a){},bae0:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ui-fft-panel-sub"},[a("div",{staticClass:"card card-display"},[a("div",{staticClass:"display-controls-header"},[a("div",{staticClass:"card-title"},[t._v("Adjusting "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.current_LUT_image===t.ImageType.ANALYTIC,expression:"current_LUT_image === ImageType.ANALYTIC"}]},[a("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("span",t._g({staticClass:"current_LUT_image highlight primarycol",on:{click:function(e){t.current_LUT_image=t.ImageType.EXPERIMENTAL}}},i),[t._v(" Analytic image ")])]}}])},[a("span",[t._v("Switch to experimental image controls")])])],1),a("span",{directives:[{name:"show",rawName:"v-show",value:t.current_LUT_image===t.ImageType.EXPERIMENTAL,expression:"current_LUT_image === ImageType.EXPERIMENTAL"}]},[a("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("span",t._g({staticClass:"current_LUT_image highlight secondarycol",on:{click:function(e){t.current_LUT_image=t.ImageType.ANALYTIC}}},i),[t._v(" Experimental image ")])]}}])},[a("span",[t._v("Switch to analytic image controls")])])],1)]),a("div",{staticClass:"display-controls-drawer"},[a("LutManager",{ref:"LUTmanager",attrs:{max_ana:t.LUT_settings_ana["range"][1]/255,min_ana:t.LUT_settings_ana["range"][0]/255,offset_ana:t.LUT_settings_ana["offset"],gamma_ana:t.LUT_settings_ana["gamma"],max_upl:t.LUT_settings_upl["range"][1]/255,min_upl:t.LUT_settings_upl["range"][0]/255,offset_upl:t.LUT_settings_upl["offset"],gamma_upl:t.LUT_settings_upl["gamma"],current_image:t.current_LUT_image},on:{new_filter_string:function(e){t.filterStrings=arguments[0]},lut_update:function(e){return t.zoomDiffractionPlot(t.lastTransform)}}}),null!=t.helixFamily?a("v-menu",{attrs:{left:"",bottom:"","close-on-click":!0,transition:"slide-y-transition","offset-y":!0},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,n=e.attrs;return[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var r=e.on;return[a("v-btn",t._g(t._b({staticClass:"display-controls-button",attrs:{color:"var(--bw-button-color)",icon:""}},"v-btn",n,!1),Object.assign({},r,i)),[a("v-icon",[t._v(" mdi-tape-measure ")])],1)]}}],null,!0)},[a("span",[t._v(" Distance measurement settings ")])])]}}],null,!1,2108884674)},[a("v-list",{attrs:{shaped:""}},[a("v-subheader",[t._v("OVERLAY SETTINGS")]),a("v-list-item",{attrs:{ripple:""}},[a("v-checkbox",{attrs:{label:"Hide distances"},model:{value:t.coordinates["hidden"],callback:function(e){t.$set(t.coordinates,"hidden",e)},expression:"coordinates['hidden']"}})],1),a("v-subheader",[t._v("DISPLAY STYLE")]),a("v-list-item",{attrs:{ripple:""}},[a("v-radio-group",{model:{value:t.coordinates_as_frequency,callback:function(e){t.coordinates_as_frequency=e},expression:"coordinates_as_frequency"}},[a("v-radio",{attrs:{color:"var(--primary)",label:"frequency[1/"+t.unit.label+"]",value:!0}}),a("v-radio",{attrs:{color:"var(--primary)",label:"wavelength (1/f)",value:!1}})],1)],1)],1)],1):t._e(),null!=t.helixFamily?a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({staticClass:"display-controls-button",attrs:{icon:"",color:"var(--bw-button-color)"},on:{click:t.toggle_maxima_overlay}},i),[a("v-icon",[t._v(" mdi-altimeter ")])],1)]}}],null,!1,1027824713)},[a("span",[t._v(" Toggle overlay of bessel functions first maxima ")])]):t._e(),null!=t.helixFamily?a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-icon",t._g({staticClass:"display-controls-button",attrs:{color:"var(--bw-button-color)"},on:{click:function(e){return t.update_plot_scale(!0)}}},i),[t._v(" mdi-arrow-split-horizontal")])]}}],null,!1,749054036)},[a("span",[t._v("resize diffraction plot to fit current n")])]):t._e(),a("v-dialog",{attrs:{persistent:"","max-width":"44rem"},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,n=e.attrs;return[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var r=e.on;return[a("v-btn",t._g(t._b({staticClass:"display-controls-button",attrs:{icon:"",color:"var(--bw-button-color)"}},"v-btn",n,!1),Object.assign({},r,i)),[a("v-icon",[t._v(" mdi-microscope ")])],1)]}}],null,!0)},[a("span",[t._v(" Upload experimental helix image ")])])]}}]),model:{value:t.show_upload_dialog,callback:function(e){t.show_upload_dialog=e},expression:"show_upload_dialog"}},[a("div",{staticClass:"upload-window"},[a("div",{staticClass:"upload-menu-title"},[a("v-subheader",[t._v("UPLOAD EXPERIMENTAL IMAGE")]),a("v-btn",{staticClass:"upload-close-mobile",attrs:{icon:"",color:"var(--primary)"},on:{click:function(e){t.show_upload_dialog=!1}}},[a("v-icon",[t._v("mdi-close-circle-outline")])],1)],1),a("img",{staticClass:"upload-preview"}),a("div",{staticClass:"upload-input"},[a("v-file-input",{attrs:{rules:t.uploadRules,filled:"",accept:"image/png, image/jpeg, image/bmp",placeholder:"Upload a local image","prepend-icon":"mdi-camera",color:"var(--primary)"},on:{change:t.show_preview},model:{value:t.imageUpload,callback:function(e){t.imageUpload=e},expression:"imageUpload"}}),null!==t.imageUpload?a("span",[a("div",{staticClass:"upload-menu-header"},[t._v("What kind of image is it?")]),a("v-radio-group",{staticClass:"compact-radio",attrs:{dense:""},model:{value:t.upload_needs_fourier,callback:function(e){t.upload_needs_fourier=e},expression:"upload_needs_fourier"}},[a("v-radio",{attrs:{label:"Realspace",value:!0,color:"var(--primary)"}}),a("v-radio",{attrs:{label:"Diffraction Pattern",value:!1,color:"var(--primary)"}})],1)],1):t._e(),null!==t.upload_needs_fourier?a("span",[a("div",[a("div",{staticClass:"upload-menu-header"},[t._v("Specify pixel size")]),a("v-text-field",{attrs:{label:"Pixel size",rules:t.numberRules,suffix:t.unit.label,color:"var(--primary)",type:"number",autofocus:""},model:{value:t.uploadScale,callback:function(e){t.uploadScale=e},expression:"uploadScale"}})],1)]):t._e(),t.uploadScale>0?a("span",[a("v-btn",{directives:[{name:"show",rawName:"v-show",value:!0===t.upload_needs_fourier,expression:"upload_needs_fourier===true"}],attrs:{color:"var(--primary)"},on:{click:function(e){return t.process_upload()}}},[t._v("compute FFT and show")]),a("v-btn",{directives:[{name:"show",rawName:"v-show",value:!1===t.upload_needs_fourier,expression:"upload_needs_fourier===false"}],attrs:{color:"var(--primary)"},on:{click:function(e){return t.process_upload()}}},[t._v("show")])],1):t._e()],1),a("v-btn",{staticClass:"upload-close",attrs:{color:"var(--primary)",outlined:""},on:{click:function(e){t.show_upload_dialog=!1}}},[t._v("close")])],1)])],1)]),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.current_LUT_image===t.ImageType.ANALYTIC,expression:"current_LUT_image === ImageType.ANALYTIC"}],staticClass:"lut_controls_analytic"},[a("div",{staticClass:"side-by-side"},[a("v-range-slider",{staticClass:"align-center",attrs:{"thumb-label":"",label:"Range",max:255,min:0,"hide-details":"",color:"var(--primary)","track-color":"var(--bw-slider-track-color)"},model:{value:t.LUT_settings_ana["range"],callback:function(e){t.$set(t.LUT_settings_ana,"range",e)},expression:"LUT_settings_ana['range']"}}),a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({directives:[{name:"show",rawName:"v-show",value:t.visible["analytic"],expression:"visible['analytic']"}],staticClass:"hide-button",attrs:{icon:"",color:"var(--primary)"},on:{click:function(e){t.visible["analytic"]=!1}}},i),[a("v-icon",[t._v("mdi-eye")])],1)]}}])},[a("span",[t._v("Hide analytic image")])]),a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({directives:[{name:"show",rawName:"v-show",value:!t.visible["analytic"],expression:"!visible['analytic']"}],staticClass:"hide-button",attrs:{icon:"",color:"var(--primary)"},on:{click:function(e){t.visible["analytic"]=!0}}},i),[a("v-icon",[t._v("mdi-eye-off")])],1)]}}])},[a("span",[t._v("Show analytic image")])])],1),a("div",{staticClass:"side-by-side-slider"},[a("v-slider",{staticClass:"ma-0 pa-0",attrs:{"thumb-label":"",label:"Offset",max:1,min:-1,step:.05,color:"var(--primary)","track-color":"var(--bw-slider-track-color)","hide-details":""},model:{value:t.LUT_settings_ana["offset"],callback:function(e){t.$set(t.LUT_settings_ana,"offset",e)},expression:"LUT_settings_ana['offset']"}}),a("v-slider",{staticClass:"ma-0 pa-0",attrs:{"thumb-label":"",label:"Gamma",max:5,min:.1,step:.1,color:"var(--primary)","track-color":"var(--bw-slider-track-color)"},model:{value:t.LUT_settings_ana["gamma"],callback:function(e){t.$set(t.LUT_settings_ana,"gamma",e)},expression:"LUT_settings_ana['gamma']"}})],1)])]),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.current_LUT_image===t.ImageType.EXPERIMENTAL,expression:"current_LUT_image === ImageType.EXPERIMENTAL"}],staticClass:"lut_controls_upload"},[a("div",{staticClass:"side-by-side"},[a("v-range-slider",{staticClass:"align-center",attrs:{"thumb-label":"",label:"Range",max:255,min:0,"hide-details":"",color:"var(--secondary)","track-color":"var(--bw-slider-track-color)"},model:{value:t.LUT_settings_upl["range"],callback:function(e){t.$set(t.LUT_settings_upl,"range",e)},expression:"LUT_settings_upl['range']"}}),a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({directives:[{name:"show",rawName:"v-show",value:t.visible["upload"],expression:"visible['upload']"}],staticClass:"hide-button",attrs:{icon:"",color:"var(--secondary)"},on:{click:function(e){t.visible["upload"]=!1}}},i),[a("v-icon",[t._v("mdi-eye")])],1)]}}])},[a("span",[t._v("Hide experimental image")])]),a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("v-btn",t._g({directives:[{name:"show",rawName:"v-show",value:!t.visible["upload"],expression:"!visible['upload']"}],staticClass:"hide-button",attrs:{icon:"",color:"var(--secondary)"},on:{click:function(e){t.visible["upload"]=!0}}},i),[a("v-icon",[t._v("mdi-eye-off")])],1)]}}])},[a("span",[t._v("Show experimental image")])])],1),a("div",{staticClass:"side-by-side-slider"},[a("v-slider",{staticClass:"ma-0 pa-0",attrs:{"thumb-label":"",label:"Offset",max:1,min:-1,step:.05,color:"var(--secondary)","track-color":"var(--bw-slider-track-color)","hide-details":""},model:{value:t.LUT_settings_upl["offset"],callback:function(e){t.$set(t.LUT_settings_upl,"offset",e)},expression:"LUT_settings_upl['offset']"}}),a("v-slider",{staticClass:"ma-0 pa-0",attrs:{"thumb-label":"",label:"Gamma",max:5,min:.1,step:.1,color:"var(--secondary)","track-color":"var(--bw-slider-track-color)"},model:{value:t.LUT_settings_upl["gamma"],callback:function(e){t.$set(t.LUT_settings_upl,"gamma",e)},expression:"LUT_settings_upl['gamma']"}})],1)])])],1),a("div",{staticClass:"card card-fft"},[a("div",{staticClass:"fft-card-header"},[a("div",{staticClass:"fft-card-header-left"},[a("div",{staticClass:"card-title"},[t._v("Diffraction pattern")]),t.updateCounter>0?a("div",[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[a("a",{attrs:{id:"download-anchor"}},[a("v-icon",t._g({staticClass:"download",on:{click:function(e){return t.download_fft()}}},i),[t._v(" mdi-download ")])],1)]}}],null,!1,354180217)},[a("span",[t._v("Download Image")])])],1):t._e()]),a("div",{staticClass:"order-dropdown-container"},[a("div",{staticClass:"order-dropdown"},[a("v-select",{attrs:{items:t.n_order_list,label:"n",color:"var(--primary)",outlined:"",dense:"","hide-details":""},model:{value:t.n_order,callback:function(e){t.n_order=e},expression:"n_order"}})],1),a("div",{staticClass:"order-dropdown"},[a("v-select",{attrs:{items:t.m_order_list,label:"m",color:"var(--primary)",outlined:"",dense:"","hide-details":""},model:{value:t.m_order,callback:function(e){t.m_order=e},expression:"m_order"}})],1)])]),a("div",{staticStyle:{margin:"0.5rem"}},[a("v-responsive",{staticClass:"image-container",attrs:{"aspect-ratio":1}},[a("canvas",{staticClass:"rasterImage"}),a("svg",{staticClass:"rasterImageOverlay"}),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.coordinates["hidden"]&&this.updateCounter>0,expression:"!coordinates['hidden'] && this.updateCounter > 0"}],staticClass:"coordinates-overlay"},[t.coordinates_as_frequency?a("div",[t._v(" f: "+t._s(t.coordinates["d"].toFixed(2))+" 1/"+t._s(t.unit.label)+" (z: "+t._s(t.coordinates["z"].toFixed(2))+" 1/"+t._s(t.unit.label)+", r: "+t._s(t.coordinates["r"].toFixed(2))+" 1/"+t._s(t.unit.label)+") ")]):t._e(),t.coordinates_as_frequency?t._e():a("div",[t._v(" 1/f: "+t._s(t.coordinates["d"].toFixed(2))+" "+t._s(t.unit.label)+" (z: "+t._s(t.coordinates["z"].toFixed(2))+" "+t._s(t.unit.label)+", r: "+t._s(t.coordinates["r"].toFixed(2))+" "+t._s(t.unit.label)+")")])]),!1===t.uploadLoaded&&0===t.updateCounter?a("div",{staticClass:"no-image-notification"},[a("v-icon",{staticClass:"no-image-icon"},[t._v("mdi-information-outline")]),a("div",[a("b",[t._v("No diffraction pattern to show")])]),a("div",{staticStyle:{opacity:"0.7"}},[t._v("Specify helix parameters or upload an experimental image")])],1):t._e()])],1)]),a("v-snackbar",{scopedSlots:t._u([{key:"action",fn:function(e){var i=e.attrs;return[a("v-btn",t._b({attrs:{color:"pink",text:""},on:{click:function(e){t.snackbar=!1}}},"v-btn",i,!1),[t._v(" Close ")])]}}]),model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v(" "+t._s(t.snackText)+" ")])],1)},n=[],r=(a("99af"),a("4de4"),a("4160"),a("caad"),a("fb6a"),a("b0c0"),a("a9e3"),a("b680"),a("4fad"),a("d3b7"),a("2532"),a("8a59"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("20bf"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("159b"),a("96cf"),a("1da1")),s=a("3835"),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[a("v-menu",{attrs:{left:"",bottom:"","close-on-click":!0,transition:"slide-y-transition","offset-y":!0},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,n=e.attrs;return[a("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var r=e.on;return[a("v-btn",t._g(t._b({staticClass:"display-controls-button",attrs:{icon:"",color:"var(--bw-button-color)"}},"v-btn",n,!1),Object.assign({},r,i)),[a("v-icon",[t._v(" mdi-palette ")])],1)]}}],null,!0)},[a("span",[t._v(" Select LUT ")])])]}}])},[a("v-list",{attrs:{shaped:""}},[a("v-subheader",[t._v("CHOOSE LUT")]),a("v-list-item",[t.current_image===t.ImageType.ANALYTIC?a("v-radio-group",{staticStyle:{"margin-top":"0"},model:{value:t.LUT_analytic,callback:function(e){t.LUT_analytic=e},expression:"LUT_analytic"}},[a("v-switch",{staticStyle:{"margin-top":"0"},attrs:{label:"invert LUT",color:t.current_image},model:{value:t.invert_LUT_ana,callback:function(e){t.invert_LUT_ana=e},expression:"invert_LUT_ana"}}),t._l(t.LUT_list,(function(e){return a("v-radio",{key:e,attrs:{color:t.current_image,label:e,value:e}})}))],2):t._e(),t.current_image===t.ImageType.EXPERIMENTAL?a("v-radio-group",{staticStyle:{"margin-top":"0"},model:{value:t.LUT_upload,callback:function(e){t.LUT_upload=e},expression:"LUT_upload"}},[a("v-switch",{staticStyle:{"margin-top":"0"},attrs:{label:"invert LUT",color:t.current_image},model:{value:t.invert_LUT_upl,callback:function(e){t.invert_LUT_upl=e},expression:"invert_LUT_upl"}}),t._l(t.LUT_list,(function(e){return a("v-radio",{key:e,attrs:{color:t.current_image,label:e,value:e}})}))],2):t._e()],1)],1)],1),a("svg",{staticStyle:{display:"none"}},[a("filter",{attrs:{id:"grayscale"}},[a("feColorMatrix",{attrs:{type:"matrix",values:".33 .33 .33 0 0\n              .33 .33 .33 0 0\n              .33 .33 .33 0 0\n              0 0 0 1 0"}})],1),a("filter",{attrs:{id:"inferno"}},[a("feComponentTransfer",{attrs:{"color-interpolation-filters":"sRGB"}},[a("feFuncR",{attrs:{type:"table",tableValues:".0.002810891 0.188894276 0.411745277 0.621527609 0.816894047 0.938706536 0.949412109  0.959399507"}}),a("feFuncG",{attrs:{type:"table",tableValues:"0.000239715 0.025561629 0.059771453 0.15592399 0.281058794 0.492124283 0.760847757 1"}}),a("feFuncB",{attrs:{type:"table",tableValues:"0.013984976 0.330141008 0.435174425 0.390325042 0.261238427 0.081251836 0.136596414 0.640626478 "}})],1)],1),a("filter",{attrs:{id:"mako"}},[a("feComponentTransfer",{attrs:{"color-interpolation-filters":"sRGB"}},[a("feFuncR",{attrs:{type:"table",tableValues:"0.04503935 0.18195582 0.25307401 0.21607792 0.20344718 0.25187832 0.54578602 0.87218969"}}),a("feFuncG",{attrs:{type:"table",tableValues:"0.01482344 0.11955283 0.23772973 0.39736958 0.56074869 0.71827158 0.8544913 0.95960708"}}),a("feFuncB",{attrs:{type:"table",tableValues:"0.02092227 0.23136943 0.48316271 0.61948028 0.65649508 0.67872193 0.69848331 0.89725384"}})],1)],1),a("filter",{attrs:{id:"magenta"}},[a("feComponentTransfer",{attrs:{"color-interpolation-filters":"sRGB"}},[a("feFuncR",{attrs:{type:"table",tableValues:"0 1"}}),a("feFuncG",{attrs:{type:"table",tableValues:"0 0"}}),a("feFuncB",{attrs:{type:"table",tableValues:"0 1"}})],1)],1),a("filter",{attrs:{id:"cyan"}},[a("feComponentTransfer",{attrs:{"color-interpolation-filters":"sRGB"}},[a("feFuncR",{attrs:{type:"table",tableValues:"0 0"}}),a("feFuncG",{attrs:{type:"table",tableValues:"0 1"}}),a("feFuncB",{attrs:{type:"table",tableValues:"0 1"}})],1)],1),a("filter",{attrs:{id:"green"}},[a("feComponentTransfer",{attrs:{"color-interpolation-filters":"sRGB"}},[a("feFuncR",{attrs:{type:"table",tableValues:"0 0"}}),a("feFuncG",{attrs:{type:"table",tableValues:"0 1"}}),a("feFuncB",{attrs:{type:"table",tableValues:"0 0"}})],1)],1),a("filter",{attrs:{id:"red"}},[a("feComponentTransfer",{attrs:{"color-interpolation-filters":"sRGB"}},[a("feFuncR",{attrs:{type:"table",tableValues:"0 1"}}),a("feFuncG",{attrs:{type:"table",tableValues:"0 0"}}),a("feFuncB",{attrs:{type:"table",tableValues:"0 0"}})],1)],1),a("filter",{attrs:{id:"minmax_a"}},[a("feComponentTransfer",[a("feFuncR",{attrs:{type:"gamma",exponent:t.gamma_ana,amplitude:1/(t.max_ana-t.min_ana),offset:-1/(t.max_ana-t.min_ana)*t.min_ana+t.offset_ana}}),a("feFuncG",{attrs:{type:"gamma",exponent:t.gamma_ana,amplitude:1/(t.max_ana-t.min_ana),offset:-1/(t.max_ana-t.min_ana)*t.min_ana+t.offset_ana}}),a("feFuncB",{attrs:{type:"gamma",exponent:t.gamma_ana,amplitude:1/(t.max_ana-t.min_ana),offset:-1/(t.max_ana-t.min_ana)*t.min_ana+t.offset_ana}})],1)],1),a("filter",{attrs:{id:"minmax_b"}},[a("feComponentTransfer",[a("feFuncR",{attrs:{type:"gamma",exponent:t.gamma_upl,amplitude:1/(t.max_upl-t.min_upl),offset:-1/(t.max_upl-t.min_upl)*t.min_upl+t.offset_upl}}),a("feFuncG",{attrs:{type:"gamma",exponent:t.gamma_upl,amplitude:1/(t.max_upl-t.min_upl),offset:-1/(t.max_upl-t.min_upl)*t.min_upl+t.offset_upl}}),a("feFuncB",{attrs:{type:"gamma",exponent:t.gamma_upl,amplitude:1/(t.max_upl-t.min_upl),offset:-1/(t.max_upl-t.min_upl)*t.min_upl+t.offset_upl}})],1)],1)])],1)},l=[];a("dca8");function c(t){var e=new Image;e.src=t;var a=document.createElement("canvas");a.width=e.width,a.height=e.height;var i=a.getContext("2d");i.drawImage(e,0,0);var n=i.getImageData(0,0,e.width,e.height);return[n,e.width,e.height]}function u(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var a=e.getContext("2d");return a.putImageData(t,0,0),e.toDataURL()}var d={ANALYTIC:"var(--primary)",EXPERIMENTAL:"var(--secondary)"};Object.freeze(d);var m={name:"LutManager",props:{min_ana:{type:Number,default:0},max_ana:{type:Number,default:1},offset_ana:{type:Number,default:0},gamma_ana:{type:Number,default:1},min_upl:{type:Number,default:0},max_upl:{type:Number,default:1},offset_upl:{type:Number,default:0},gamma_upl:{type:Number,default:1},current_image:{type:String,default:d.ANALYTIC}},data:function(){return{LUT_analytic:"grayscale",LUT_upload:"grayscale",LUT_list:["grayscale","inferno","mako","cyan","magenta","red","green"],invert_LUT_ana:!1,invert_LUT_upl:!1,filterString:"",ImageType:d}},methods:{buildFilterString:function(){var t,e;t=this.invert_LUT_ana?"url(#minmax_a) invert(1) url(#".concat(this.LUT_analytic,")  "):"url(#minmax_a) url(#".concat(this.LUT_analytic,")"),e=this.invert_LUT_upl?"url(#minmax_b) invert(1) url(#".concat(this.LUT_upload,")"):"url(#minmax_b) url(#".concat(this.LUT_upload,")"),this.$emit("new_filter_string",[t,e]),this.$emit("lut_update")}},mounted:function(){console.log("[LUT manager loaded]");for(var t=0,e=["LUT_analytic","LUT_upload","max_ana","min_ana","offset_ana","gamma_ana","max_upl","min_upl","offset_upl","gamma_upl","invert_LUT_ana","invert_LUT_upl"];t<e.length;t++){var a=e[t];this.$watch(a,this.buildFilterString)}}},p=m,h=a("2877"),v=a("6544"),f=a.n(v),_=a("8336"),b=a("132d"),g=a("8860"),y=a("da13"),x=a("e449"),w=a("67b6"),k=a("43a6"),S=a("e0c7"),T=a("b73d"),C=a("3a2f"),F=Object(h["a"])(p,o,l,!1,null,"40df3288",null),L=F.exports;f()(F,{VBtn:_["a"],VIcon:b["a"],VList:g["a"],VListItem:y["a"],VMenu:x["a"],VRadio:w["a"],VRadioGroup:k["a"],VSubheader:S["a"],VSwitch:T["a"],VTooltip:C["a"]});var U=a("5698");function M(t,e,a,i,n,r){for(var s=["white","#FF5d5d","#FA8072","#ffc013","#ffdb79","#1f66e5","#6495ED","#505050","#B8B8B8"],o=[],l=0;l<i+1;l++)o.push(l),0!==l&&o.push(-l);for(var c=U["b"]("body").append("div").attr("class","maxima maxima-tooltip").style("opacity",0),u=0,d=function(){var i=p[m],o=[];for(var l in n){var d=-i/(a.rise*r),h=l/(a.frequency*a.rise*r),v=e(+l)/(2*r*Math.PI*a.radius);o.push({z:d+h,r:v,n:l,m:i}),0!==h&&o.push({z:d-h,r:v,n:l,m:i}),0!==v&&(o.push({z:d+h,r:-v,n:l,m:i}),o.push({z:d-h,r:-v,n:l,m:i}))}t.selectAll("maxima").data(o).enter().append("circle").attr("class","maxima m_num_".concat(i)).attr("r",4).attr("cx",(function(t){return t.r})).attr("cy",(function(t){return t.z})).attr("stroke","black").attr("stroke-width",1.5).attr("fill",s[u]).on("mouseover",(function(t,e){U["b"](this).transition().duration("100").attr("r",7),c.transition().duration(100).style("opacity",1),c.html("n = ".concat(e.n," | m = ").concat(e.m)).style("left",t.pageX+10+"px").style("top",t.pageY-15+"px"),document.querySelectorAll(".maxima").forEach((function(t){return t.style.opacity=.3})),document.querySelectorAll(".m_num_".concat(i)).forEach((function(t){return t.style.opacity=1}))})).on("mouseout",(function(t,e){U["b"](this).transition().duration("200").attr("r",4),c.transition().duration("200").style("opacity",0),document.querySelectorAll(".maxima").forEach((function(t){return t.style.opacity=1}))})),u++},m=0,p=o;m<p.length;m++)d()}var z={name:"FourierPanel",components:{LutManager:L},props:{helixFamily:{type:Array},name:{type:String},updateCounter:{type:Number,default:0},externalDisplayParams:{type:Object},rasterSize:{type:Number,default:512},unit:{type:Object,default:function(){return{label:"Å",factor:.1}}}},watch:{updateCounter:{handler:function(){this.updateFFT(!1)}},visible:{deep:!0,handler:function(){this.zoomDiffractionPlot(this.lastTransform)}},rasterSize:{handler:function(){this.canvas.width=this.rasterSize,this.canvas.height=this.rasterSize}},n_order:{handler:function(){this.updateFFT(!1)}},m_order:{handler:function(){this.updateFFT(!1)}}},data:function(){return{analyticFFT:null,n_order:5,n_order_list:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],m_order:0,m_order_list:[0,1,2,3,4,5,6,7],canvas:null,overlay:null,ctx:null,displayFac:1,plot_scale:.01,camera:null,scene:null,LUT_settings_ana:{range:[0,255],offset:0,gamma:1},LUT_settings_upl:{range:[0,255],offset:0,gamma:1},ImageType:d,current_LUT_image:d.ANALYTIC,filterStrings:["none","none"],imageData:[],imageDataTest:[],image:null,upload_image:null,upload_dim:{width:0,height:0},visible:{analytic:!0,upload:!0},show_maxima_overlay:!1,wasm:null,wasm_fft_analytic:null,wasm_fft:null,wasm_bessel_max:null,coordinates_as_frequency:!1,coordinates:{d:0,z:0,r:0,hidden:!1},uploadRules:[function(t){return!t||t.size<2e6||"Image size should be less than 2 MB!"}],imageUpload:null,upload_needs_fourier:null,show_upload_dialog:!1,uploadScale:0,uploadLoaded:!1,numberRules:[function(t){return!!t||"parameter is required"},function(t){return t>0||"value must be larger than 0"}],lastTransform:U["d"],snackbar:!1,snackText:""}},methods:{updateFFT:function(t){var e;t&&this.update_plot_scale(!1),console.time("diffraction-analytic-wasm"),e=this.wasm_fft_analytic(this.helixFamily,this.n_order,this.m_order,this.plot_scale,this.rasterSize);var a=new ImageData(Uint8ClampedArray.from(e),this.rasterSize,this.rasterSize);this.ctx.putImageData(a,0,0),this.image.src=this.canvas.toDataURL(),console.timeEnd("diffraction-analytic-wasm"),this.refreshContrast()},update_plot_scale:function(t){var e=this.n_order/(this.helixFamily[0]["rise"]*this.helixFamily[0]["frequency"]*this.plot_scale);this.plot_scale=e/(this.rasterSize/2*.7)*this.plot_scale,t&&this.updateFFT()},refreshContrast:function(){var t=this;console.log("refreshing image contrast"),this.$nextTick((function(){t.zoomDiffractionPlot(t.lastTransform),t.show_maxima_overlay&&(t.toggle_maxima_overlay(),t.toggle_maxima_overlay())}))},download_fft:function(){console.log("> exporting FFT image");var t=document.getElementById("download-anchor"),e=(new Date).toISOString().slice(0,10);t.setAttribute("href",this.canvas.toDataURL());var a="".concat(e,"_FFT_").concat(this.name);t.setAttribute("download",a)},exportDisplayParams:function(){var t={};5!==this.n_order&&(t["n"]=this.n_order),0!==this.m_order&&(t["m"]=this.m_order),.01!==this.plot_scale&&(t["s"]=+(100*this.plot_scale).toFixed(2)),this.$emit("exportDisplayParams",t)},setDisplayParams:function(){for(var t=0,e=Object.entries(this.externalDisplayParams);t<e.length;t++){var a=Object(s["a"])(e[t],2),i=a[0],n=a[1];"n"===i?this.n_order_list.includes(+n)&&(this.n_order=+n):"m"==i?this.m_order_list.includes(+n)&&(this.m_order=+n):"s"==i&&n>0&&(this.plot_scale=n/100)}},process_upload:function(){var t=this;console.log("Processing Uploaded image");var e=new FileReader;e.readAsDataURL(this.imageUpload),e.onload=function(){try{var a,i,n=c(e.result),r=Object(s["a"])(n,3);if(a=r[0],t.upload_dim.width=r[1],t.upload_dim.height=r[2],t.upload_needs_fourier){console.time("wasm-FFT");var o=t.wasm_fft(a.data,t.upload_dim.width,t.upload_dim.height);console.timeEnd("wasm-FFT"),t.upload_dim.width=o[o.length-2],t.upload_dim.height=o[o.length-1],i=new ImageData(Uint8ClampedArray.from(o.slice(0,-2)),t.upload_dim.width,t.upload_dim.height)}else i=a;t.upload_image.src=u(i),console.log("upload pixelsize is: ",t.uploadScale),localStorage.setItem("last_upload_pixelsize",String(t.uploadScale)),t.refreshContrast(),t.uploadLoaded=!0,t.show_upload_dialog=!1}catch(l){t.snackText="Oops, something went wrong with uploaded image",t.snackbar=!0,t.uploadLoaded=!1,console.log(l)}}},updateMouseCoordinate:function(t){var e=U["a"](t),a=(Math.round(e[0])-.5)*this.plot_scale*this.displayFac,i=(Math.round(e[1])-.5)*this.plot_scale*this.displayFac;this.coordinates_as_frequency?(this.coordinates["d"]=Math.round(100*Math.sqrt(Math.pow(a,2)+Math.pow(i,2)))/100,this.coordinates["z"]=Math.abs(Math.round(100*i)/100),this.coordinates["r"]=Math.abs(Math.round(100*a)/100)):(this.coordinates["d"]=Math.round(1/Math.sqrt(Math.pow(a,2)+Math.pow(i,2))*100)/100,this.coordinates["z"]=Math.abs(Math.round(1/i*100)/100),this.coordinates["r"]=Math.abs(Math.round(1/a*100)/100))},zoomDiffractionPlot:function(t){this.lastTransform=t;var e=t.k;this.overlay.attr("transform",t);var a=this.rasterSize*e,i=this.rasterSize*e;this.ctx.save(),this.ctx.clearRect(0,0,this.rasterSize,this.rasterSize),this.ctx.translate(-(a-this.rasterSize)/2+t.x*this.displayFac,-(i-this.rasterSize)/2+t.y*this.displayFac),this.ctx.scale(e,e),this.visible["analytic"]&&(this.ctx.filter=this.filterStrings[0],this.ctx.drawImage(this.image,0,0,this.rasterSize,this.rasterSize)),this.visible["upload"]&&(this.ctx.filter=this.filterStrings[1],this.drawUpload()),this.ctx.restore()},drawUpload:function(){var t=1/this.uploadScale*1/this.plot_scale*.002;this.ctx.drawImage(this.upload_image,0,0,this.upload_dim.width,this.upload_dim.height,this.rasterSize*(1-t)/2,this.rasterSize*(1-t)/2,this.rasterSize*t,this.rasterSize*t)},toggle_maxima_overlay:function(){console.log("Toggling maxima overlay (SVG) to ".concat(!this.show_maxima_overlay)),this.show_maxima_overlay?(this.show_maxima_overlay=!1,document.querySelectorAll(".maxima").forEach((function(t){return t.remove()}))):(this.show_maxima_overlay=!0,M(this.overlay,this.wasm_bessel_max,this.helixFamily[0],this.m_order,this.n_order_list,this.plot_scale*this.displayFac))},show_preview:function(){var t=new FileReader;t.addEventListener("load",(function(){document.querySelector(".upload-preview").src=t.result}),!1),this.imageUpload&&t.readAsDataURL(this.imageUpload)},loadWASMfuncs:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.wasm;case 2:return t.wasm_fft_analytic=e.sent.wasm_diffraction_analytic,e.next=5,t.wasm;case 5:return t.wasm_fft=e.sent.wasm_FFT,e.next=8,t.wasm;case 8:t.wasm_bessel_max=e.sent.wasm_bessel_first_max;case 9:case"end":return e.stop()}}),e)})))()}},mounted:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.canvas=document.querySelector(".rasterImage"),t.canvas.width=t.rasterSize,t.canvas.height=t.rasterSize,t.ctx=t.canvas.getContext("2d"),t.ctx.imageSmoothingEnabled=!1,t.ctx.globalCompositeOperation="lighten",t.image=new Image,t.upload_image=new Image,t.wasm=a.e("chunk-44e91c20").then(a.bind(null,"a549")),e.next=11,t.loadWASMfuncs();case 11:t.setDisplayParams(),i=document.querySelector(".image-container").clientWidth,n=document.querySelector(".image-container").clientHeight,t.displayFac=t.rasterSize/i,t.overlay=U["b"](".rasterImageOverlay").attr("viewBox",[-i/2,-n/2,i,n]).on("mousemove",(function(e){t.updateMouseCoordinate(e)})).call(U["c"]().extent([[-i/2,-n/2],[i/2,n/2]]).scaleExtent([1,5]).translateExtent([[-i/2,-n/2],[i/2,n/2]]).on("zoom",(function(e){var a=e.transform;return t.zoomDiffractionPlot(a)}))),t.overlay.node(),t.$refs.LUTmanager.buildFilterString(),r=localStorage.getItem("last_upload_pixelsize"),null!==r&&(t.uploadScale=Number(r)),console.log("[ Fourierpanel mounted ]");case 21:case"end":return e.stop()}}),e)})))()}},I=z,N=(a("cf5e"),a("3167"),a("ac7c")),R=a("169a"),V=a("23a7"),O=a("5963"),A=a("6b53"),P=a("b974"),E=a("ba0d"),j=a("2db4"),D=a("8654"),H=Object(h["a"])(I,i,n,!1,null,"13e05076",null);e["a"]=H.exports;f()(H,{VBtn:_["a"],VCheckbox:N["a"],VDialog:R["a"],VFileInput:V["a"],VIcon:b["a"],VList:g["a"],VListItem:y["a"],VMenu:x["a"],VRadio:w["a"],VRadioGroup:k["a"],VRangeSlider:O["a"],VResponsive:A["a"],VSelect:P["a"],VSlider:E["a"],VSnackbar:j["a"],VSubheader:S["a"],VTextField:D["a"],VTooltip:C["a"]})},bd9c:function(t,e,a){},c553:function(t,e,a){},cddb:function(t,e,a){},cf5e:function(t,e,a){"use strict";var i=a("cddb"),n=a.n(i);n.a},f849:function(t,e,a){},fde3:function(t,e,a){"use strict";var i=a("f849"),n=a.n(i);n.a}});
//# sourceMappingURL=app.d8098ef9.js.map